<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Venetto - Sistema de Inspe√ß√£o Veicular</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            .print\\:hidden {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // √çcones SVG simplificados
        const Check = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;
        const X = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const Printer = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>;
        const Save = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const Settings = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"/></svg>;
        const Plus = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Trash2 = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const Edit2 = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>;
        const Truck = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>;
        const FileText = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>;
        const Search = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
        const Calendar = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const Filter = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>;
        const Download = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const Eye = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>;

        // Simula√ß√£o do window.storage (voc√™ vai usar o real do Claude)
        window.storage = {
            data: {},
            async get(key) {
                const value = localStorage.getItem(key);
                return value ? { key, value } : null;
            },
            async set(key, value) {
                localStorage.setItem(key, value);
                return { key, value };
            },
            async delete(key) {
                localStorage.removeItem(key);
                return { key, deleted: true };
            },
            async list(prefix) {
                const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix));
                return { keys };
            }
        };

        function App() {
            const [showConfig, setShowConfig] = useState(false);
            const [showVehicleForm, setShowVehicleForm] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [showReports, setShowReports] = useState(false);
            const [editingVehicle, setEditingVehicle] = useState(null);
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [viewingChecklist, setViewingChecklist] = useState(null);
            
            const [reportFilters, setReportFilters] = useState({
                startDate: '',
                endDate: '',
                placa: '',
                motorista: '',
                categoria: '',
                status: 'todos'
            });

            const [categories, setCategories] = useState([
                'MEC√ÇNICA',
                'EL√âTRICA',
                'PNEUS',
                'FLUIDOS',
                'SEGURAN√áA',
                'DOCUMENTA√á√ÉO'
            ]);
            
            const [newCategory, setNewCategory] = useState('');
            const [vehicles, setVehicles] = useState([]);
            const [newVehicle, setNewVehicle] = useState({ placa: '', motorista: '' });
            const [checklistHistory, setChecklistHistory] = useState([]);
            
            const [formData, setFormData] = useState({
                data: new Date().toISOString().split('T')[0],
                placa: '',
                condutor: '',
                items: [
                    { numero: 1, categoria: 'MEC√ÇNICA', descricao: 'SETOR DE DIRE√á√ÉO VAZANDO MUITO', status: null },
                    { numero: 2, categoria: 'MEC√ÇNICA', descricao: 'OLHAR OS BEXIG√ÉO DESCENDO SOZINHO', status: null },
                    { numero: 3, categoria: 'EL√âTRICA', descricao: 'LANTERNAS LATERAL QUEBRADA', status: null },
                    { numero: 4, categoria: 'EL√âTRICA', descricao: 'LUZ DA CABINE SEM FUNCIONAR', status: null },
                    { numero: 5, categoria: 'PNEUS', descricao: 'VERIFICAR PRESS√ÉO DOS PNEUS', status: null },
                    { numero: 6, categoria: 'PNEUS', descricao: 'VERIFICAR DESGASTE E DANOS', status: null },
                    { numero: 7, categoria: 'FLUIDOS', descricao: 'N√çVEL DE √ìLEO DO MOTOR', status: null },
                    { numero: 8, categoria: 'FLUIDOS', descricao: 'N√çVEL DE √ÅGUA DO RADIADOR', status: null },
                    { numero: 9, categoria: 'SEGURAN√áA', descricao: 'TRI√ÇNGULO E EXTINTOR', status: null },
                    { numero: 10, categoria: 'SEGURAN√áA', descricao: 'CINTO DE SEGURAN√áA', status: null },
                ],
                observacoes: ''
            });

            useEffect(() => {
                loadAllData();
            }, []);

            const loadAllData = async () => {
                setLoading(true);
                try {
                    const categoriesData = await window.storage.get('checklist-categories');
                    if (categoriesData) {
                        setCategories(JSON.parse(categoriesData.value));
                    }

                    const vehiclesData = await window.storage.get('checklist-vehicles');
                    if (vehiclesData) {
                        setVehicles(JSON.parse(vehiclesData.value));
                    }

                    await loadHistory();
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadHistory = async () => {
                try {
                    const keys = await window.storage.list('checklist-history:');
                    if (keys && keys.keys) {
                        const historyPromises = keys.keys.map(async (key) => {
                            try {
                                const data = await window.storage.get(key);
                                return data ? JSON.parse(data.value) : null;
                            } catch (error) {
                                return null;
                            }
                        });
                        
                        const historyData = await Promise.all(historyPromises);
                        const validHistory = historyData.filter(h => h !== null);
                        setChecklistHistory(validHistory.sort((a, b) => new Date(b.data) - new Date(a.data)));
                    }
                } catch (error) {
                    console.error('Erro ao carregar hist√≥rico:', error);
                }
            };

            const saveCategories = async (newCategories) => {
                setCategories(newCategories);
                try {
                    await window.storage.set('checklist-categories', JSON.stringify(newCategories));
                } catch (error) {
                    alert('Erro ao salvar categorias');
                }
            };

            const saveVehicles = async (newVehicles) => {
                setVehicles(newVehicles);
                try {
                    await window.storage.set('checklist-vehicles', JSON.stringify(newVehicles));
                } catch (error) {
                    alert('Erro ao salvar ve√≠culos');
                }
            };

            const saveChecklist = async () => {
                if (!formData.placa || !formData.condutor) {
                    alert('Preencha a placa e o condutor antes de salvar!');
                    return;
                }

                setSaving(true);
                try {
                    const checklistId = `checklist-history:${Date.now()}`;
                    const checklistData = {
                        id: checklistId,
                        ...formData,
                        savedAt: new Date().toISOString()
                    };

                    await window.storage.set(checklistId, JSON.stringify(checklistData));
                    await loadHistory();
                    
                    alert('‚úÖ Checklist salvo com sucesso!');
                } catch (error) {
                    alert('Erro ao salvar checklist');
                } finally {
                    setSaving(false);
                }
            };

            const handleItemStatusChange = (index, status) => {
                const newItems = [...formData.items];
                newItems[index].status = status;
                setFormData({ ...formData, items: newItems });
            };

            const addNewItem = () => {
                const newNumber = formData.items.length + 1;
                setFormData({
                    ...formData,
                    items: [...formData.items, { numero: newNumber, categoria: '', descricao: '', status: null }]
                });
            };

            const removeItem = (index) => {
                const newItems = formData.items.filter((_, i) => i !== index);
                const renumberedItems = newItems.map((item, i) => ({ ...item, numero: i + 1 }));
                setFormData({ ...formData, items: renumberedItems });
            };

            const handlePrint = () => {
                window.print();
            };

            const getCheckedCount = () => {
                return formData.items.filter(item => item.status !== null).length;
            };

            const addCategory = () => {
                if (newCategory.trim()) {
                    const updated = [...categories, newCategory.toUpperCase().trim()];
                    saveCategories(updated);
                    setNewCategory('');
                }
            };

            const removeCategory = (index) => {
                const updated = categories.filter((_, i) => i !== index);
                saveCategories(updated);
            };

            const addVehicle = () => {
                if (newVehicle.placa.trim() && newVehicle.motorista.trim()) {
                    const vehicle = {
                        id: Date.now(),
                        placa: newVehicle.placa.toUpperCase().trim(),
                        motorista: newVehicle.motorista.toUpperCase().trim()
                    };
                    saveVehicles([...vehicles, vehicle]);
                    setNewVehicle({ placa: '', motorista: '' });
                    setShowVehicleForm(false);
                }
            };

            const updateVehicle = () => {
                if (editingVehicle && editingVehicle.placa.trim() && editingVehicle.motorista.trim()) {
                    const updated = vehicles.map(v => 
                        v.id === editingVehicle.id 
                            ? { ...v, placa: editingVehicle.placa.toUpperCase().trim(), motorista: editingVehicle.motorista.toUpperCase().trim() }
                            : v
                    );
                    saveVehicles(updated);
                    setEditingVehicle(null);
                }
            };

            const removeVehicle = (id) => {
                const updated = vehicles.filter(v => v.id !== id);
                saveVehicles(updated);
            };

            const selectVehicle = (vehicle) => {
                setFormData({
                    ...formData,
                    placa: vehicle.placa,
                    condutor: vehicle.motorista
                });
            };

            const loadChecklistFromHistory = (checklist) => {
                setFormData({
                    data: new Date().toISOString().split('T')[0],
                    placa: checklist.placa,
                    condutor: checklist.condutor,
                    items: checklist.items.map(item => ({ ...item, status: null })),
                    observacoes: ''
                });
                setShowHistory(false);
                setShowReports(false);
            };

            const deleteChecklistFromHistory = async (checklistId) => {
                if (confirm('Tem certeza que deseja excluir este checklist?')) {
                    try {
                        await window.storage.delete(checklistId);
                        await loadHistory();
                    } catch (error) {
                        alert('Erro ao excluir checklist');
                    }
                }
            };

            const newChecklist = () => {
                setFormData({
                    data: new Date().toISOString().split('T')[0],
                    placa: '',
                    condutor: '',
                    items: [
                        { numero: 1, categoria: 'MEC√ÇNICA', descricao: 'SETOR DE DIRE√á√ÉO VAZANDO MUITO', status: null },
                        { numero: 2, categoria: 'MEC√ÇNICA', descricao: 'OLHAR OS BEXIG√ÉO DESCENDO SOZINHO', status: null },
                        { numero: 3, categoria: 'EL√âTRICA', descricao: 'LANTERNAS LATERAL QUEBRADA', status: null },
                        { numero: 4, categoria: 'EL√âTRICA', descricao: 'LUZ DA CABINE SEM FUNCIONAR', status: null },
                        { numero: 5, categoria: 'PNEUS', descricao: 'VERIFICAR PRESS√ÉO DOS PNEUS', status: null },
                        { numero: 6, categoria: 'PNEUS', descricao: 'VERIFICAR DESGASTE E DANOS', status: null },
                        { numero: 7, categoria: 'FLUIDOS', descricao: 'N√çVEL DE √ìLEO DO MOTOR', status: null },
                        { numero: 8, categoria: 'FLUIDOS', descricao: 'N√çVEL DE √ÅGUA DO RADIADOR', status: null },
                        { numero: 9, categoria: 'SEGURAN√áA', descricao: 'TRI√ÇNGULO E EXTINTOR', status: null },
                        { numero: 10, categoria: 'SEGURAN√áA', descricao: 'CINTO DE SEGURAN√áA', status: null },
                    ],
                    observacoes: ''
                });
                setShowHistory(false);
                setShowReports(false);
            };

            const filteredHistory = checklistHistory.filter(item => 
                item.placa.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.condutor.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const getFilteredChecklists = () => {
                return checklistHistory.filter(item => {
                    if (reportFilters.startDate && new Date(item.data) < new Date(reportFilters.startDate)) return false;
                    if (reportFilters.endDate && new Date(item.data) > new Date(reportFilters.endDate)) return false;
                    if (reportFilters.placa && !item.placa.toLowerCase().includes(reportFilters.placa.toLowerCase())) return false;
                    if (reportFilters.motorista && !item.condutor.toLowerCase().includes(reportFilters.motorista.toLowerCase())) return false;
                    if (reportFilters.categoria) {
                        const hasCategory = item.items.some(i => i.categoria === reportFilters.categoria);
                        if (!hasCategory) return false;
                    }
                    if (reportFilters.status !== 'todos') {
                        const hasProblems = item.items.some(i => i.status === 'problema');
                        const allChecked = item.items.every(i => i.status !== null);
                        if (reportFilters.status === 'problemas' && !hasProblems) return false;
                        if (reportFilters.status === 'ok' && hasProblems) return false;
                        if (reportFilters.status === 'pendentes' && allChecked) return false;
                    }
                    return true;
                });
            };

            const printReport = () => {
                window.print();
            };

            const exportReportCSV = () => {
                const filtered = getFilteredChecklists();
                let csv = 'Data,Placa,Motorista,Total Itens,Itens OK,Problemas,Status\n';
                
                filtered.forEach(item => {
                    const okCount = item.items.filter(i => i.status === 'ok').length;
                    const problemCount = item.items.filter(i => i.status === 'problema').length;
                    const status = problemCount > 0 ? 'COM PROBLEMAS' : 'OK';
                    
                    csv += `${new Date(item.data).toLocaleDateString('pt-BR')},${item.placa},${item.condutor},${item.items.length},${okCount},${problemCount},${status}\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `relatorio-checklist-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            const getReportStats = () => {
                const filtered = getFilteredChecklists();
                return {
                    totalChecklists: filtered.length,
                    totalProblems: filtered.reduce((sum, item) => sum + item.items.filter(i => i.status === 'problema').length, 0),
                    totalOk: filtered.reduce((sum, item) => sum + item.items.filter(i => i.status === 'ok').length, 0),
                    checklistsWithProblems: filtered.filter(item => item.items.some(i => i.status === 'problema')).length
                };
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
                            <p className="text-gray-600 font-semibold">Carregando dados...</p>
                        </div>
                    </div>
                );
            }

            // Continue com o resto do c√≥digo do componente...
            // (A interface completa do checklist aqui)
            
            return (
                <div className="min-h-screen bg-gray-100 p-4">
                    <div className="max-w-4xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
                        <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center space-x-4">
                                    <div className="bg-white text-blue-800 w-16 h-16 flex items-center justify-center rounded-lg font-bold text-2xl">
                                        GV
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold">GRUPO VENETTO</h1>
                                        <p className="text-blue-200 text-sm">Checklist de Inspe√ß√£o Veicular</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="p-6">
                            <p className="text-center text-gray-600">Sistema de Checklist em funcionamento! üöõ</p>
                            <p className="text-center text-sm text-gray-500 mt-2">
                                Cole o c√≥digo completo do artifact aqui para ter todas as funcionalidades
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
